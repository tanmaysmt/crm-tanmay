<div class="wrapper">
    <app-navbar (permissions)="receiveMessage($event)" (userinfo)="receiveUserInfo($event)"></app-navbar>
    <app-aside ></app-aside>
    <div class="content-wrapper kanban">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <h1>Leads</h1>
                    </div>
                    <div class="col-sm-6 d-none d-sm-block" *ngIf="editLead">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><button type="button" class="btn btn-block btn-primary" data-toggle="modal" data-target="#addTasks" >Add Tasks</button></li>
                            <li ><a *ngIf="editLead" routerLink="/crm/leads/{{lead_id}}" class="btn btn-block btn-primary ml-1">Edit Lead</a></li>
                            <li ><button class="btn btn-block btn-primary ml-2 mr-2" data-toggle="modal" data-target="#modal-lg">  Convert</button></li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>
        <section class="content">
            <div class="cardsloader" *ngIf="loading">
                <div class="cardloader is-loading">
                    <div class="content">
                        <h2></h2>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="card card-default color-palette-box">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-tag"></i>
                            {{lead_details.title}}
                        </h3>
                    </div> 
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-text-width"></i>
                                    Lead Information
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <dl class="row">
                                            <dt class="col-sm-4">Lead Owner</dt>
                                            <dd class="col-sm-8">{{lead_owner.name}}</dd>
                                            <dt class="col-sm-4">Lead Name</dt>
                                            <dd class="col-sm-8">{{lead_details.title}}</dd>
                                            <dt class="col-sm-4">Lead Source</dt>
                                            <dd class="col-sm-8">{{lead_details.lead_source}}</dd>
                                            <dt class="col-sm-4">Lead Status</dt>
                                            <dd class="col-sm-8">{{lead_details.lead_status}}</dd>                                       
                                        </dl>
                                    </div>
                                    <div class="col-md-6">
                                        <dl class="row">
                                            <dt class="col-sm-4">Company </dt>
                                            <dd class="col-sm-8">{{lead_details.company}}</dd>
                                            <dt class="col-sm-4">Industry </dt>
                                            <dd class="col-sm-8">{{lead_details.industry}}</dd>
                                            <dt class="col-sm-4">Number of employee </dt>
                                            <dd class="col-sm-8">{{lead_details.number_of_employee}}</dd>
                                            <dt class="col-sm-4">Annual Revenue</dt>
                                            <dd class="col-sm-8">{{lead_details.annual_revenue}}</dd>
                                        </dl>
                                    </div>
                                </div>             
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-text-width"></i>
                                    Contact Person
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <dl class="row">
                                            <dt class="col-sm-4">Name</dt>
                                            <dd class="col-sm-8">{{lead_details.first_name}} {{lead_details.last_name}}</dd>   
                                            <dt class="col-sm-4">Gender</dt>
                                            <dd class="col-sm-8"> {{lead_details.gender}}</dd>
                                            <dt class="col-sm-4">Date of Birth</dt>
                                            <dd class="col-sm-8"> {{lead_details.dob}}</dd>
                                            <dt class="col-sm-4">Company </dt>
                                            <dd class="col-sm-8"> {{lead_details.company}}</dd>                                                                     
                                        </dl>
                                    </div>
                                    <div class="col-md-6">
                                        <dl class="row">
                                            <dt class="col-sm-4">Phone </dt>
                                            <dd class="col-sm-8"> {{lead_details.phone}}</dd>    
                                            <dt class="col-sm-4">Email </dt>
                                            <dd class="col-sm-8"> {{lead_details.email}}</dd> 
                                            <dt class="col-sm-4">Secondary Email </dt>
                                            <dd class="col-sm-8"> {{lead_details.email2}}</dd>   
                                            <dt class="col-sm-4">Fax </dt>
                                            <dd class="col-sm-8"> {{lead_details.fax}}</dd> 
                                            <dt class="col-sm-4">Website</dt>
                                            <dd class="col-sm-8"> {{lead_details.website}}</dd>
                                        </dl>
                                    </div>
                                </div>                        
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-text-width"></i>
                                    Address
                                </h3>
                            </div>
                            <div class="card-body">
                                <dl class="row">
                                    <dt class="col-sm-4">Address</dt>
                                    <dd class="col-sm-8">{{lead_details.address}}</dd>   
                                    <dt class="col-sm-4">City </dt>
                                    <dd class="col-sm-8"> {{lead_details.city}}</dd>    
                                    <dt class="col-sm-4">State </dt>
                                    <dd class="col-sm-8"> {{lead_details.state}}</dd>    
                                    <dt class="col-sm-4">Country </dt>
                                    <dd class="col-sm-8"> {{lead_details.country}}</dd>
                                    <dt class="col-sm-4">Zip </dt>
                                    <dd class="col-sm-8"> {{lead_details.zip}}</dd>                             
                                </dl>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-text-width"></i>
                                    Lead Reports
                                </h3>
                            </div>
                            <div class="card-body">
                                <table class="table table-hover text-nowrap">
                                    <thead>
                                      <tr>
                                          <th>Call Action</th>
                                          <th>Feed Back Status</th>
                                          <th>Lead Owner</th>
                                          <th>Scheduled At</th>
                                          <th>Remarks</th>
                                          <th>Action</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr *ngFor="let fd of feedbacks">
                                            <td>
                                              <p *ngIf="fd.callAction">{{fd.callAction.action}}</p>
                                            </td>
                                            <td>
                                                <p *ngIf="fd.feedbackStatus">{{fd.feedbackStatus.status}}</p>
                                            </td>
                                            <td>{{fd.profile.user.first_name}}</td>
                                            <td>{{fd.scheduled_time | date:'medium' }}</td>
                                            <td>{{fd.description }}</td>
                                            <td>
                                                <a routerLink="/crm/feedbacks/{{lead_id}}" class="btn btn-info"><i class="fas fa-eye"></i></a>
                                            </td>
                                      </tr>
                                    </tbody>
                                  </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="m-0 text-dark">Tasks</h3>
                                    </div> 
                                    <div class="col-sm-6">
                                        <ol class="breadcrumb float-sm-right">
                                            <li class="breadcrumb-item"><button type="button" class="btn btn-block btn-outline-primary btn-sm" data-toggle="modal" data-target="#addTasks">Add Tasks</button></li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body table-responsive p-0">
                                <table class="table table-hover text-nowrap">
                                  <thead>
                                    <tr>
                                        <th>title</th>
                                        <th>Task for</th>
                                        <th>Related to</th>
                                        <th>Status</th>
                                        <th>Priority</th>
                                        <th>Task Owner</th>
                                        <th>Action</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let task of tasklist">
                                        <td>{{task.title}}</td>
                                        <td>{{task.task_for}}</td>
                                        <td>{{task.related_to}}</td>
                                        <td>{{task.status}}</td>
                                        <td>{{task.priority}}</td>
                                        <td>{{task.profile.user.first_name}}</td>
                                        <td>
                                            <a routerLink="/crm/tasks/{{task.id}}" class="btn btn-info"><i class="fas fa-edit"></i></a>
                                        </td>
                                    </tr>
                                  </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <app-footer *ngIf="loading==false"></app-footer>
<div>
<div class="modal fade" id="modal-lg">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Leads Settings</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">          
                        <div class="card card-primary card-outline">
                            <div class="card-header">
                                <h5 class="card-title m-0">Featured</h5>
                            </div>
                            <div class="card-body">           
                                <p class="card-text">Create New Account .</p>
                                <p class="card-text">Create New Contact .</p>
                                <form role="form" [formGroup]= "convertlead" (ngSubmit)='onSubmit(convertlead.value)'>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Owner of New Record</label>
                                        <select class="form-control" formControlName="profile_id">
                                            <option *ngFor = "let uts of userlists" value = "{{uts.id}}">{{uts.user.name}}</option>
                                        </select>
                                    </div>                    
                                    <div class="card-footer">
                                        <button type="submit" class="btn btn-primary">Convert</button>
                                    </div>
                                </form>                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addTasks">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Leads Settings</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" role="form" [formGroup]= "edittask" (ngSubmit)='TaskSubmit(edittask.value)' >
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Tasks Owner</label>
                                <div class="col-sm-9">
                                    <select class="form-control" formControlName = "profile_id">
                                        <option *ngFor = "let uts of userlists"  value = "{{uts.id}}">{{uts.user.name}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Subject <small class="text-danger">*</small></label>
                                <div class="col-sm-9">
                                    <input type="text" [class.is-invalid]="edittask.get('title')?.invalid && edittask.get('title')?.touched" class="form-control" formControlName = "title" placeholder="Subject" />
                                    <small [class.d-none]="edittask.get('title')?.valid || edittask.get('title')?.untouched" class="text-danger">Please Add Subject to Task</small>
                                </div>
                            </div>   
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Related To<small class="text-danger">*</small></label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" disabled="disabled" value="{{lead_details.first_name}} {{lead_details.last_name}}">
                                    <input type="hidden" formControlName = "task_for" class="form-control" value="lead">
                                    <input type="hidden" formControlName = "task_related_to" class="form-control" value="{{lead_details.id}}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="control-label col-sm-3 col-form-label" for="flatpickr01">Due Date</label>
                                <div class="col-sm-9">
                                    <input type="date" formControlName = "due_date" class="form-control">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Status<small class="text-danger">*</small></label>
                                <div class="col-sm-9">
                                    <select class="form-control" formControlName = "status">
                                        <option value = "1">Not Started</option>
                                        <option value = "2">In Progress</option>
                                        <option value = "3">Completed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Priority<small class="text-danger">*</small></label>
                                <div class="col-sm-9">
                                    <select class="form-control" formControlName = "priority">
                                        <option value = "1">High</option>
                                        <option value = "2">Highest</option>
                                        <option value = "3">Low</option>
                                        <option value = "4">Lowest</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" rows="3" formControlName = "description" placeholder="Enter ..."></textarea>
                            </div> 
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>